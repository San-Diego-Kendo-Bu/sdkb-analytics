<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SDKB Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
  <style>
    body { margin: 0; background: #f4f6f8; }
    .nav-link { cursor: pointer; }
        .nafudakake-container { display: none; }
        .nafudakake-container.active { display: block; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <!-- Nafudakake Content -->
  <div id="nafudakake-content" class="nafudakake-container">
    <div id="shelf"></div>
    <div id="modalOverlay">
        <div id="modalForm">
            <header>
                <h2>Edit Member</h2>
                <button id="removeButton">Remove</button>
            </header>
            <label>
                <select id="editStatus" name="editStatus">
                    <option value="active">Active Member</option>
                    <option value="exempt">Exempt Member</option>
                    <option value="inactive">Inactive Member</option>
                    <option value="guest">Guest</option>
                </select>
            </label>
            <label>
                First Name:
                <input type="text" id="editFirstName">
            </label>
            <label>
                Last Name:
                <input type="text" id="editLastName">
            </label>
            <label>
                Zekken Text:
                <input type="text" id="editZekken">
            </label>

            <label>
                Email:
                <input type="email" id="editEmail">
            </label>
            <label>
                Birthday:
                <input type="date" id="editBirthday">
            </label>
            <label>
                Rank:
                <div style="display:flex;">
                    <input type="number" id="editRankNumber" min="0" max="8" style="width:40%;">
                    <select id="editRankType" style="width:60%;">
                        <option value="dan">Dan</option>
                        <option value="kyu">Kyu</option>
                        <option value="shihan">Shihan</option>
                    </select>
                </div>
            </label>
            <div class="modal-buttons">
                <button id="saveButton">Save</button>
                <button id="cancelButton">Cancel</button>
            </div>
        </div>
    </div>

    <div class="dropdown-buttons-container">
        <button id="addDropdownButton" style="background-color: #b8860b; display: none;">
            <img src="./assets/icons/add_person_white.png" width="50px">
        </button>

        <button id="removeDropdownButton" style="background-color: #b8860b; display: none;">
            <img src="./assets/icons/remove_person_white.png" width="50px">
        </button>

        <button id="searchDropdownButton" style="background-color: #b8860b; display: none;">
            <img src="./assets/icons/search.png" width="30px">
        </button>

        <button id="downloadDropdownButton" style="background-color: #b8860b; display: none;">
            <img src="./assets/icons/download.png" width="40px">
        </button>
    </div>

    <div id="remove-member" style="display: none;">
        <button id="openRemoveButton">REMOVE MEMBER</button>
    </div>

    <div id="search-member" style="display: none;">
        <button id="openSearchButton">SEARCH MEMBER</button>
    </div>

    <div id="download-member" style="display: none;">
        <button id="openDownloadButton">DOWNLOAD CSV</button>
    </div>

    <div id="add-member">
        <button id="openAddButton">ADD MEMBER</button>
        <button id="openAddGroupButton">ADD FROM CSV</button>
        <input type="file" id="groupCsvInput" accept=".csv" style="display:none;">
    </div>

    <form id='addForm' class='formOverlay' action='https://jlsml5sfaj.execute-api.us-east-2.amazonaws.com/members'
        method='POST'>
        <label for="addFirstName">First Name (Required)</label>
        <input type="text" id="addFirstName" name="first_name" required>
        <label for="addLastName">Last Name (Required)</label>
        <input type="text" id="addLastName" name="last_name" required>
        <label for="addRankNumber">Rank (Required)</label>
        <div style="display: flex;">
            <input type="number" id="addRankNumber" name="rank_number" min="0" max="8" style="width:40%;" required>
            <select id="addRankType" name="rank_type" style="width:60%;">
                <option value="kyu">Kyu</option>
                <option value="dan">Dan</option>
                <option value="shihan">Shihan</option>
            </select>
        </div>

        <label for="addZekken">Zekken</label>
        <input type="text" id="addZekken" name="zekken_text">
        <label for="addEmail">Email (Required)</label>
        <input type="text" id="addEmail" name="email" required>
        <label for="addBirthday">Birthday</label>
        <input type="date" id="addBirthday" name="birthday">

        <div style="display: flex; flex-direction: row; margin-top: 5px; gap: 5%; margin-top: 5%; margin-bottom: 5%;">
            <input type="checkbox" value="yes" id="isGuest" name="isGuest" style="width: 20px; height: 20px;">
            <label for="isGuest" style="font-size: 1.0em;">I'm adding a guest</label>
        </div>

        <div class="form-action-buttons">
            <input id="addButton" type="submit" value="Add">
            <button id="cancelAddButton" type="button" class="cancel-form-button">Cancel</button>
        </div>
    </form>

    <form id='removeForm' class='formOverlay' style="display: none;">
        <label for="removeFirstName">First Name (Required)</label>
        <input type="text" id="removeFirstName" name="first_name" required>
        <label for="removeLastName">Last Name (Required)</label>
        <input type="text" id="removeLastName" name="last_name" required>

        <div class="form-action-buttons">
            <button id="searchRemoveButton" type="button">Search</button>
            <button id="cancelRemoveButton" type="button" class="cancel-form-button">Cancel</button>
        </div>

        <div id="removeResults" style="display: none; margin-top: 20px;">
            <h3>Matching Members:</h3>
            <div id="removeResultsList"></div>
        </div>
    </form>

    <form id='searchForm' class='formOverlay' style="display: none;">
        <label for="searchFirstName">First Name (Required)</label>
        <input type="text" id="searchFirstName" name="first_name" required>
        <label for="searchLastName">Last Name (Required)</label>
        <input type="text" id="searchLastName" name="last_name" required>

        <div class="form-action-buttons">
            <button id="searchMemberButton" type="button">Search</button>
            <button id="cancelSearchButton" type="button" class="cancel-form-button">Cancel</button>
        </div>

        <div id="searchResults" style="display: none; margin-top: 20px;">
            <h3>Matching Members:</h3>
            <div id="searchResultsList"></div>
        </div>
    </form>
  </div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script type="module">
    import { renderTable, layoutShelf, setupEventListeners } from "./js/nafudaManager.js";
    import * as buttonLogic from "./js/buttonLogic.js";

    const { useState, createElement: e, useEffect } = React;
    const { createRoot } = ReactDOM;

    const tabs = ['Nafudakake', 'Pay', 'Events', 'Admin Control'];

    const Placeholder = ({ title }) => e(
      'div',
      { className: 'p-4 bg-white border rounded shadow-sm text-center text-muted' },
      e('h4', { className: 'mb-2' }, title),
      e('p', { className: 'mb-0' }, 'Coming soon.')
    );

    const Content = ({ activeTab }) => {
      if (activeTab === 'Nafudakake') {
        return null;
      }
      return e(Placeholder, { title: activeTab });
    };

    function App() {
    const [activeTab, setActiveTab] = useState('Nafudakake');

            useEffect(() => {
                const nafudakakeContent = document.getElementById('nafudakake-content');
                const handleResize = () => layoutShelf();
        
                if (activeTab === 'Nafudakake' && nafudakakeContent) {
                    nafudakakeContent.classList.add('active');
                    renderTable();
                    buttonLogic.setButtonsDisplay();
                    setupEventListeners();
                    window.addEventListener('resize', handleResize);
                } else if (nafudakakeContent) {
                    nafudakakeContent.classList.remove('active');
                }

                return () => {
                    window.removeEventListener('resize', handleResize);
                };
            }, [activeTab]);

            useEffect(() => {
                const signInBtn = document.getElementById('signIn');
                const signOutBtn = document.getElementById('signOut');

                if (signInBtn) signInBtn.addEventListener('click', buttonLogic.signInLogic);
                if (signOutBtn) signOutBtn.addEventListener('click', buttonLogic.signOutLogic);

                buttonLogic.setButtonsDisplay();

                return () => {
                    if (signInBtn) signInBtn.removeEventListener('click', buttonLogic.signInLogic);
                    if (signOutBtn) signOutBtn.removeEventListener('click', buttonLogic.signOutLogic);
                };
            }, []);

      return e(
        'div',
                { className: 'bg-light' },
                e(
                    'nav',
                    { className: 'navbar navbar-expand-lg navbar-light bg-white mb-4 shadow-sm' },
                    e(
                        'div',
                        { className: 'container-fluid' },
                        e('a', { className: 'navbar-brand', href: '#' }, 'SDKB Portal'),
                        e('button', {
                            className: 'navbar-toggler',
                            type: 'button',
                            'data-bs-toggle': 'collapse',
                            'data-bs-target': '#navbarNav'
                        }, e('span', { className: 'navbar-toggler-icon' })),
                        e(
                            'div',
                            { className: 'collapse navbar-collapse', id: 'navbarNav' },
                            e(
                                'ul',
                                { className: 'navbar-nav me-auto' },
                                tabs.map(tab => e(
                                    'li',
                                    { className: 'nav-item', key: tab },
                                    e(
                                        'a',
                                        {
                                            className: `nav-link${activeTab === tab ? ' active' : ''}`,
                                            onClick: () => setActiveTab(tab)
                                        },
                                        tab
                                    )
                                ))
                            ),
                            e(
                                'div',
                                { className: 'd-flex gap-2' },
                                e('button', { id: 'signIn', className: 'btn btn-warning' }, 'Sign In'),
                                e('button', { id: 'signOut', className: 'btn btn-outline-secondary', style: { display: 'none' } }, 'Sign Out')
                            )
                        )
                    )
                ),
        activeTab !== 'Nafudakake' && e(
          'div',
          { className: 'container-fluid pb-4' },
          e(Content, { activeTab })
        )
      );
    }

    const mount = document.getElementById('root');
    if (mount) {
      createRoot(mount).render(e(App));
    }
  </script>
  <script type="module" src="js/buttonLogic.js"></script>
</body>
</html>